// Prisma schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

model User {
  id        String   @id @default(uuid())
  name      String?
  email     String   @unique
  password  String

  avatar    String?        // profile picture
  sellerLogo String?       // pharmacy logo (SELLER only)

  role      Role     @default(CUSTOMER)
  phone String?
  isActive  Boolean  @default(true)

  medicines  Medicine[]
  orders     Order[]
  reviews    Review[]
  orderItems OrderItem[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}


enum Role {
  CUSTOMER
  SELLER
  ADMIN
}

model Category {
  id        String   @id @default(uuid())
  name      String   @unique
  
  image     String?          // category banner/icon
  isActive  Boolean  @default(true)

  medicines Medicine[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

 
}


model Medicine {
  id           String   @id @default(uuid())
  name         String
  brand        String
  form         MedicineForm
  price        Float
  stock        Int
  description String
  manufacturer String

  images String[] @default([])   

  status MedicineStatus @default(ACTIVE)

  sellerId   String
  seller User @relation(fields: [sellerId], references: [id], onDelete: Restrict)


  categoryId String
  category   Category @relation(fields: [categoryId], references: [id])

  reviews    Review[]
  orderItems OrderItem[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}


enum MedicineForm {
  TABLET
  CAPSULE
  SYRUP
  INJECTION
  OINTMENT
  DROPS
}

enum MedicineStatus {
  ACTIVE
  OUT_OF_STOCK
  DISABLED
}

model Order {
  id          String       @id @default(uuid())

  customerId  String
  customer    User         @relation(fields: [customerId], references: [id], onDelete: Cascade)

  status      OrderStatus  @default(PLACED)

  total       Float
  address     String
  phone       String     
  paymentMethod String     @default("COD")
  items       OrderItem[]

  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@index([customerId])
  @@index([status])
}

model OrderItem {
  id         String   @id @default(uuid())

  orderId    String
  order      Order    @relation(fields: [orderId], references: [id], onDelete: Cascade)

  medicineId String
  medicine   Medicine @relation(fields: [medicineId], references: [id], onDelete: Restrict)
  //  Restrict recommended: sold medicine delete prevent

  //  seller snapshot (seller orders easily)
  sellerId   String
  seller     User     @relation(fields: [sellerId], references: [id], onDelete: Cascade)

  quantity   Int
  price      Float     // snapshot price

  @@index([orderId])
  @@index([medicineId])
  @@index([sellerId])
}

enum OrderStatus {
  PLACED
  PROCESSING
  SHIPPED
  DELIVERED
  CANCELLED
}

model Review {
  id         String   @id @default(uuid())

  rating     Int
  comment    String?

  userId     String
  user       User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  medicineId String
  medicine   Medicine @relation(fields: [medicineId], references: [id], onDelete: Cascade)

  @@unique([userId, medicineId])

  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt   
  @@index([medicineId])
  @@index([userId])
}
